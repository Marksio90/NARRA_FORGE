# PostgreSQL configuration for NarraForge
# Tuned for pgvector workloads (embedding storage + similarity search)

# --- Connection Settings ---
listen_addresses = '*'
max_connections = 100

# --- Memory ---
# Adjust based on container memory (assumes 2-4GB available)
shared_buffers = 512MB
effective_cache_size = 1536MB
work_mem = 16MB
maintenance_work_mem = 256MB

# --- WAL ---
wal_buffers = 16MB
min_wal_size = 256MB
max_wal_size = 1GB
checkpoint_completion_target = 0.9

# --- Query Planner ---
# Favor index scans for pgvector similarity queries
random_page_cost = 1.1
effective_io_concurrency = 200
default_statistics_target = 100

# --- Parallel Queries ---
max_worker_processes = 4
max_parallel_workers_per_gather = 2
max_parallel_workers = 4
max_parallel_maintenance_workers = 2

# --- Logging ---
log_min_duration_statement = 1000  # Log queries slower than 1s
log_statement = 'ddl'
log_timezone = 'UTC'

# --- pgvector-specific ---
# ivfflat probes: higher = more accurate but slower
# Default is 1; 10 gives good accuracy for NarraForge scale
# Set at session level for search queries if needed:
#   SET ivfflat.probes = 10;
